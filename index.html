<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Tesis</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="assets/images/icon/favicon.ico">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/themify-icons.css">
    <link rel="stylesheet" href="assets/css/metisMenu.css">
    <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="assets/css/slicknav.min.css">
    <!-- amchart css -->
    <link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
    <!-- others css -->
    <link rel="stylesheet" href="assets/css/typography.css">
    <link rel="stylesheet" href="assets/css/default-css.css">
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    <!-- modernizr css -->
    <script src="assets/js/vendor/modernizr-2.8.3.min.js"></script>
    <style>
        .main-content-inner {
            width: 100%;
            max-height: 100%;
            background-image: url("assets/images/fonts/fondo3.jpg");
            justify-content: center;
        }
        .map-container {
            position: relative;
            padding-bottom: 100%; 
            height: 0;
            overflow: hidden;
        }
        .map-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .progress-container {
    display: flex;
    align-items: center;
  }

  .progress-bar {
    flex: 1;
    height: 20px;
    background-color: #ebe2e2;
  }

  .progress {
    height: 100%;
    transition: width 0.3s ease;
  }

  .progress-value {
    margin-left: 10px;
  }
    </style>
</head>

<body>
    <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <!-- preloader area start -->
    <div id="preloader">
        <div class="loader"></div>
    </div>
    <!-- preloader area end -->
    <!-- page container area start -->
    <div>
        <!-- main content area start -->
        <div class="main-content">
            <div class="main-content-inner">
                 <!-- page title area start -->
                <div class="page-title-area colorbarra">
                    <div class="row align-items-center">
                        <div class="col-sm-6">
                            <div class="clearfix">
                                <h4 class="page-title pull-left">RED DE MONITOREO</h4>
                            </div>
                        </div>
                        <div class="col-sm-6 clearfix">
                            <div class="user-profile pull-right">
                                <img class="avatar fa-user-md" src="assets/images/author/avatar.png" alt="avatar">
                                <h4 class="user-name dropdown-toggle" data-toggle="dropdown">Tesista<i class="fa fa-angle-down"></i></h4>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" href="login.html">Cerrar Sesi√≥n</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <br>
                <h4><div id="tiempo_actualizacion" style="float: left;"></div>
                    <div id="tiempo_actualizacion_mov" style="float: right;"></div></h4>
                <!-- page title area end -->
                <!-- sales report area start -->
                <div class="sales-report-area mt-5 mb-5">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="single-report mb-xs-30">
                                <div class="s-report-inner pr--20 pt--30 mb-3">
                                    <div class="icon"><i class="fa fa-cloud"></i></div>
                                    <div class="s-report-title d-flex align-items-center">
                                        <h4 class="header-title mb-0">HUMEDAD</h4>
                                    </div>
                                    <div class="d-flex justify-content-between pb-2">
                                        <h1 id="app_humedad"></h1>
                                    </div>
                                </div>
                                <canvas id="coin_sales1" height="50"></canvas>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="single-report mb-xs-30">
                                <div class="s-report-inner pr--20 pt--30 mb-3">
                                    <div class="icon"><i class="fa fa-tachometer"></i></div>
                                    <div class="s-report-title d-flex align-items-center">
                                        <h4 class="header-title mb-0">TEMPERATURA</h4>
                                    </div>
                                    <div class="d-flex justify-content-between pb-2">
                                        <h1 id="app_temperatura"></h1>
                                    </div>
                                </div>
                                <canvas id="coin_sales2" height="50"></canvas>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="single-report">
                                <div class="s-report-inner pr--20 pt--30 mb-3">
                                    <div class="icon"><i class="fa fa-user"></i></div>
                                    <div class="s-report-title d-flex align-items-center">
                                        <h4 class="header-title mb-0">MOVIMIENTO</h4>
                                    </div>
                                    <div class="d-flex justify-content-between pb-2">
                                        <h3 id="app_movimiento"></h3>
                                    </div>
                                </div>
                                <h6 id="date_last_mov"></h6>
                                <canvas id="coin_sales3" height="50"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- sales report area end -->
                <!-- overview area start -->
                <div class="row">
                    <div class="col-xl-8 col-lg-8">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h4 class="header-title mb-0">Historial</h4>
                                    <select class="custome-select border-0 pr-3" onchange="toggleContent(this.value)">
                                        <option selected id="opc-humedad">Humedad</option>
                                        <option value="0" id="opc-temperatura">Temperatura</option>
                                    </select>
                                </div>
                                <hr>
                                <input type="date" id="start" name="trip-start" min="2024-02-01" />
                                <div id="verview-shart" style="display: block;"></div>
                                <div id="verview-shart-t" style="display: none;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 col-lg-4 coin-distribution">
                        <div class="card h-full">
                            <div class="card-body">
                                <h4 class="header-title mb-0">Mapa de enlaces</h4>
                                <hr>
                                <div class="map-container"><iframe src="https://www.google.com/maps/embed?pb=!1m34!1m12!1m3!1d2011157.5128278823!2d-67.38206984809415!3d10.09564315289955!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!4m19!3e2!4m5!1s0x8c2d740d55b939f1%3A0x6a6baaf6f31a1448!2sPuerto%20La%20Cruz%2C%20Anzo%C3%A1tegui!3m2!1d10.2007985!2d-64.6334643!4m5!1s0x8c2aaa20760411b1%3A0x80d974a28823a010!2sSan%20Juan%20de%20Los%20Morros!3m2!1d9.9126704!2d-67.36145859999999!4m5!1s0x8c2a5ff496279f45%3A0xce0fc9843f5ba7f6!2sCaracas%2C%20Distrito%20Capital!3m2!1d10.4647119!2d-66.9765068!5e0!3m2!1ses!2sve!4v1708141076970!5m2!1ses!2sve" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe></div>
                                <hr>
                                <h4 class="header-title mb-0">Calidad de enlaces</h4>
                                <hr>
                                <label>Enlace-Sensor H y T</label> 
                                <div class="progress-container">
                                    <div class="progress-bar">
                                      <div class="progress" id="progress"></div>
                                    </div>
                                    <div class="progress-value" id="progressValue"></div>
                                  </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- overview area end -->               
            </div>
        </div>
        <!-- main content area end -->
        <!-- footer area start-->
        <footer>
            <div class="footer-area">
                <p>¬© Copyright 2024<a href=""></a></p>
            </div>
        </footer>
        <!-- footer area end-->
    </div>
    <!-- offset area end -->
    <!-- jquery latest version -->
    <script src="assets/js/vendor/jquery-2.2.4.min.js"></script>
    <!-- bootstrap 4 js -->
    <script src="assets/js/popper.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>

    <!-- start chart js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
    <!-- start zingchart js -->
    <script src="https://cdn.zingchart.com/zingchart.min.js"></script>
    <script>
    zingchart.MODULESDIR = "https://cdn.zingchart.com/modules/";
    ZC.LICENSE = ["569d52cefae586f634c54f86dc99e6a9", "ee6b7db5b51705a13dc2339db3edaf6d"];
    </script>
    <script src="assets/js/scripts.js"></script>
    <script type="module">
        function convertirTiempo(valor) {
            var horas = Math.floor(valor);
            var minutos = Math.round((valor - horas) * 60);
            var tiempo = horas.toString().padStart(2, '0') + ':' + minutos.toString().padStart(2, '0');
            return tiempo;
        }

        // Update the progress bar based on the value
        function updateProgressBar(value, value2) {
            const progress = document.getElementById('progress');
            const progressValue = document.getElementById('progressValue');
            const progressWidth = (130 - value) / 130 * 100;
            progress.style.width = progressWidth + '%';

            if (value >= 0 && value <= 42) {
                progress.style.backgroundColor = '#53F555';
            } else if (value > 42 && value <= 86) {
                progress.style.backgroundColor = '#239E25';
            } else if (value > 86 && value <= 95) {
                progress.style.backgroundColor = '#9B9E23';
            } else if (value > 95 && value <= 107) {
                progress.style.backgroundColor = '#9E8423';
            } else if (value > 107 && value <= 118) {
                progress.style.backgroundColor = '#9E4123';
            } else if (value > 118 && value <= 129) {
                progress.style.backgroundColor = '#FF0000';
            }

            progressValue.textContent = value2;
        }

        const humedadelements = [];
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
        import { getDatabase, ref, set, get, child, onValue, orderByKey, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
    
        // Your web app's Firebase configuration
        const firebaseConfig = {
        apiKey: "AIzaSyCymg0Ho3HMgHht2DYgRzZSekn2aZyMzco",
        authDomain: "tesis-esp.firebaseapp.com",
        databaseURL: "https://tesis-esp-default-rtdb.firebaseio.com",
        projectId: "tesis-esp",
        storageBucket: "tesis-esp.appspot.com",
        messagingSenderId: "998026311452",
        appId: "1:998026311452:web:4daa62dae5d8230700acd9"
        };
    
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
       
    
        //get ref to database services
        const db = getDatabase(app);
    
        const messageRef = ref(db, 'sensores/DHT11');
        const messageRefMov = ref(db, 'sensores/movimiento');
        
        get(messageRef).then((snapshot) => {
            if (snapshot.exists()) {
                const children = snapshot.val();
                const lastChildText = JSON.stringify(children);
                const obj = JSON.parse(lastChildText);
                const humedadValues = [];
                for (const key in obj) {
                    if (obj.hasOwnProperty(key)) {
                        const humedad = obj[key].humedad;
                        humedadValues.push(humedad);
                    }
                }
                const values = Object.values(humedadValues);
                const humedadelements = values.slice(0, 10);
            } else {
                //console.log("No data available");
            }
        }).catch((error) => {
        console.error("Error getting data:", error);
        });
        // Retrieve all children of the messageRef node
        setInterval(() => {
            get(messageRef)
            .then((snapshot) => {
                var app_humedad = document.getElementById('app_humedad');
                var app_temperatura = document.getElementById('app_temperatura');
                var tiempo_actualizacion = document.getElementById('tiempo_actualizacion');
                tiempo_actualizacion.style.color = "white";
                tiempo_actualizacion.style.textAlign = "left";
                
                if (snapshot.exists()) {
                    const children = snapshot.val();
                    const keys = Object.keys(children);
                    const lastKey = keys[keys.length - 1];
                    const lastChild = children[lastKey];
                    const lastChildText = JSON.stringify(lastChild);
                    const objeto = JSON.parse(lastChildText);
                    const humedad = objeto['humedad'];
                    const temperatura = objeto['temperatura'];
                    const potencia = objeto['potencia_rx'];
                    const newpotencia = JSON.stringify(potencia);
                    var value = newpotencia.replace(/"/g, ""); 
                    var value2 = parseInt(value);
                    value = value.replace(/-/g, "");
                    console.log("VALUEEE", parseInt(value));
                    updateProgressBar(parseInt(value),value2);
                    const time = objeto['tiempo'];
                    var valores = time.match(/\((.*?)\)/)[1];
                    var lista = valores.split(", ");
                    var a√±o = parseInt(lista[0]);
                    var mes = parseInt(lista[1]);
                    var dia = parseInt(lista[2]);
                    var hora = parseInt(lista[3]);
                    var minuto = parseInt(lista[4]);
                    var fecha = new Date(a√±o, mes - 1, dia, hora, minuto); // Restamos 1 al mes porque los meses en JavaScript comienzan desde 0
                    var formatoFecha = fecha.toLocaleDateString();
                    var formatoHora = fecha.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }); // Obtiene el formato de fecha local del navegador
                    //console.log("time", formatoFecha); // Imprime la fecha formateada

                    const newhumedad = JSON.stringify(humedad);
                    const newtemperatura = JSON.stringify(temperatura);
                    const newtiempo = "√öltima actualizaci√≥n de H. y T. : " + JSON.stringify(formatoFecha) + " " + JSON.stringify(formatoHora);
                    app_humedad.innerText = newhumedad.replace(/"/g, "") + " %";
                    app_temperatura.innerText = newtemperatura.replace(/"/g, "") + " ¬∞C";
                    tiempo_actualizacion.innerText = newtiempo.replace(/"/g, "");
                } else {
                    //console.log("El nodo 'sensores/DHT11' no tiene hijos en la base de datos");
                }
            })
            .catch((error) => {
                console.error("Error al leer el mensaje:", error);
            });
        }, 5000);
        setInterval(() => {
            get(messageRefMov)
            .then((snapshot) => {
                var app_movimiento = document.getElementById('app_movimiento');
                var tiempo_actualizacion_mov = document.getElementById('tiempo_actualizacion_mov');
                var date_last_mov = document.getElementById('date_last_mov');
                date_last_mov.style.color = "white";
                tiempo_actualizacion_mov.style.color = "white";
                tiempo_actualizacion_mov.style.textAlign = "right";
                if (snapshot.exists()) {
                    const children = snapshot.val();
                    const childrenText = JSON.stringify(children);
                    const objetoListaMov = JSON.parse(childrenText);
                    const elementosMovimientos = [];
                    const tiempoValues = [];
                    var contador = 0;
                    var ultimoValor = "";
                    var ultimaposicion = 0;
                    for (const key in objetoListaMov) {
                        if (objetoListaMov.hasOwnProperty(key)) {
                            const mov = objetoListaMov[key].deteccion;
                            //console.log("no entro", mov);
                            if(mov == "Movimiento detectado"){
                                //console.log("entro", mov);
                                contador++;
                            }
                            elementosMovimientos.push(mov);
                        }
                    }
                    for (const key in objetoListaMov) {
                        if (objetoListaMov.hasOwnProperty(key)) {
                            const tiempo = objetoListaMov[key].tiempo;
                            tiempoValues.push(tiempo);
                        }
                    }
                    for (var i = elementosMovimientos.length - 1; i >= 0; i--) {
                        if (elementosMovimientos[i] === "Movimiento detectado") {
                            ultimoValor = elementosMovimientos[i];
                            ultimaposicion = i;
                            break;
                        }
                    }
                    //console.log("tiempo", tiempoValues);
                    //console.log("movimientos", elementosMovimientos);
                    //console.log("ultimo valor", tiempoValues[ultimaposicion]);
                    var valores_mov = tiempoValues[ultimaposicion].match(/\((.*?)\)/)[1];
                    var lista_mov = valores_mov.split(", ");
                    var a√±o_mov = parseInt(lista_mov[0]);
                    var mes_mov = parseInt(lista_mov[1]);
                    var dia_mov = parseInt(lista_mov[2]);
                    var hora_mov = parseInt(lista_mov[3]);
                    var minuto_mov = parseInt(lista_mov[4]);
                    var fecha_mov = new Date(a√±o_mov, mes_mov - 1, dia_mov, hora_mov, minuto_mov); // Restamos 1 al mes porque los meses en JavaScript comienzan desde 0
                    var formatoFecha_mov = fecha_mov.toLocaleDateString();
                    var formatoHora_mov = fecha_mov.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }); // Obtiene el formato de fecha local del navegador
                    //console.log("time_movimiento", formatoFecha_mov, formatoHora_mov); // Imprime la fecha formateada
                    const keys = Object.keys(children);
                    const lastKey = keys[keys.length - 1];
                    const lastChild = children[lastKey];
                    const lastChildText = JSON.stringify(lastChild);
                    const objeto = JSON.parse(lastChildText);
                    const movimiento = objeto['deteccion'];
                    const time = objeto['tiempo'];
                    const newmovimiento = JSON.stringify(movimiento);

                    var valores = time.match(/\((.*?)\)/)[1];
                    var lista = valores.split(", ");
                    var a√±o = parseInt(lista[0]);
                    var mes = parseInt(lista[1]);
                    var dia = parseInt(lista[2]);
                    var hora = parseInt(lista[3]);
                    var minuto = parseInt(lista[4]);
                    var fecha = new Date(a√±o, mes - 1, dia, hora, minuto); // Restamos 1 al mes porque los meses en JavaScript comienzan desde 0
                    var formatoFecha = fecha.toLocaleDateString();
                    var formatoHora = fecha.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }); // Obtiene el formato de fecha local del navegador
                    //console.log("time", formatoFecha); // Imprime la fecha formateada

                    const newtiempo = "√öltima actualizaci√≥n de M. : " + JSON.stringify(formatoFecha) + " " + JSON.stringify(formatoHora);

                    tiempo_actualizacion_mov.innerText = newtiempo.replace(/"/g, "");

                    app_movimiento.innerText = newmovimiento.replace(/"/g, "");
                    date_last_mov.innerText = "√ölt. movimiento detectado: "+JSON.stringify(formatoFecha_mov).replace(/"/g, "") + " " + JSON.stringify(formatoHora_mov).replace(/"/g, "");
                } else {
                    //console.log("El nodo 'sensores/movimiento' no tiene hijos en la base de datos");
                }
            })
            .catch((error) => {
                console.error("Error al leer el mensaje:", error);
            });
        }, 5000);
        /*--------------  overview-chart start ------------*/
        if ($('#verview-shart').length) {
            const firebaseConfig = {
            apiKey: "AIzaSyCymg0Ho3HMgHht2DYgRzZSekn2aZyMzco",
            authDomain: "tesis-esp.firebaseapp.com",
            databaseURL: "https://tesis-esp-default-rtdb.firebaseio.com",
            projectId: "tesis-esp",
            storageBucket: "tesis-esp.appspot.com",
            messagingSenderId: "998026311452",
            appId: "1:998026311452:web:4daa62dae5d8230700acd9"
            };
        
            const app = initializeApp(firebaseConfig);
            const db = getDatabase(app);
            var elementos = [];
            const messageRef = ref(db, 'sensores/DHT11');

            setInterval(() => {
                get(messageRef).then((snapshot) => {
                    if (snapshot.exists()) {
                        const children = snapshot.val();
                        const campoFecha = document.getElementById('start');
                        var valorFecha = campoFecha.value;
                        var fecha = new Date(valorFecha);
                        var dia = fecha.getDate() +1;
                        var mes = fecha.getMonth() + 1;
                        var year = fecha.getFullYear();
                        campoFecha.addEventListener('input', function() {
                            valorFecha = campoFecha.value;
                            fecha = new Date(valorFecha);
                            year = fecha.getFullYear();
                            dia = fecha.getDate() + 1;
                            mes = fecha.getMonth() + 1;
                            //console.log("D√≠a: ", dia);
                            //console.log("Mes: ", mes);
                            //console.log("A√±o: ", year);
                        });

                        //console.log("fecha", valorFecha); 
                        //console.log("children", children)
                        const lastChildText = JSON.stringify(children);
                        const obj = JSON.parse(lastChildText);
                        const humedadValues = [];
                        const tiempoValues = [];
                        for (const key in obj) {
                            if (obj.hasOwnProperty(key)) {
                                const humedad = obj[key].humedad;
                                humedadValues.push(humedad);
                            }
                        }

                        for (const key in obj) {
                            if (obj.hasOwnProperty(key)) {
                                const tiempo = obj[key].tiempo;
                                tiempoValues.push(tiempo);
                            }
                        }

                        //console.log("tiempo", tiempoValues);
                        const valuest = Object.values(tiempoValues);
                        const posiciones = [];

                        for (var i = 0; i < valuest.length; i++) {
                            var hora = valuest[i].split(',');
                            var horanew = hora[0].replace(/^\(/, '');
                            var mesnew = hora[1].replace(/^\ /, '');
                            var dianew = hora[2].replace(/^\ /, '');
                            if(horanew == year.toString()){
                                if(mesnew == mes.toString()){
                                    if(dianew == dia.toString()){
                                        posiciones.push(i);
                                    }
                                }
                            }
                        }

                        //console.log("posiciones", posiciones);
                        const elementost = valuest.slice(-10);
                        //console.log("tiempo", elementost);
                        const values = Object.values(humedadValues);
                        const elementos = values.slice(-10);
                        //console.log("humedad", elementos);
                        const listaDeEnteros = elementos.map(str => parseInt(str));
                        const listaHoras = [];
                        const listaMin = [];
                        for (var i = 0; i < valuest.length; i++) {
                            var hora = valuest[i].split(',');
                            listaHoras.push(hora[3]);
                            listaMin.push(hora[4]);
                        }
                        const listaHorasNew = listaHoras.map(str => parseInt(str));
                        const listaMinNew = listaMin.map(str => parseInt(str));
                        const puntos = [];
                        //console.log("Fechas:", listaHorasNew);
                        //console.log("Rangos:", humedadValues);
                        var ejeHumedad = []; 
                        for (var i = 0; i < posiciones.length; i++) {
                            ejeHumedad.push(parseInt(humedadValues[posiciones[i]]));
                            var minutosTotales = parseInt(listaHorasNew[posiciones[i]]) * 60 + parseInt(listaMinNew[posiciones[i]]);
                            var minimoMinutos = Math.floor(minutosTotales / 60) * 60; // Redondear hacia abajo a la hora m√°s cercana
                            var maximoMinutos = minimoMinutos + 60; // Sumar 60 minutos para obtener la siguiente hora

                            var valorEnEscalaLarge = ((minutosTotales - minimoMinutos) / (maximoMinutos - minimoMinutos));
                            var valorEnEscala = Math.round(valorEnEscalaLarge * 100) / 100;
                            //console.log(parseInt(listaHorasNew[posiciones[i]]), "-", parseInt(listaMinNew[posiciones[i]]), "-", minutosTotales, "-", valorEnEscala+parseInt(listaHorasNew[posiciones[i]]));
                            const punto = [valorEnEscala+parseInt(listaHorasNew[posiciones[i]]), parseInt(humedadValues[posiciones[i]])]; // Crear el punto [x, y] a partir de los elementos correspondientes de las listas
                            //console.log("cada punto", punto);
                            puntos.push(punto); // Agregar el punto a la lista de puntos
                        }
                        //console.log("puntos", puntos); // Imprimir los puntos resultantes
                        var minimo = Math.min(...ejeHumedad) - 1;
                        var maximo = Math.max(...ejeHumedad) + 1;
                        //console.log("max", maximo);
                        //console.log("min", minimo);

                        function formatTime(value) {
                            var hours = Math.floor(value);
                            var minutes = Math.floor((value - hours) * 60);
                            //console.log("minutos", value, minutes);
                            return value*60;
                        }

                        var myConfig = {
                            "type": "line",
                            "scale-x": {
                                "values": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23],
                                "label": {
                                "font-size": 14,
                                "offset-x": 0
                                },
                                "item": {
                                "font-size": 10
                                },
                                "guide": {
                                "visible": false,
                                "line-style": "solid"
                                }
                            },
                            "scale-y": {
                                "min-value": minimo,
                                "max-value": maximo,
                                "label": {
                                "font-size": 14,
                                "offset-x": 0
                                },
                                "item": {
                                "font-size": 10
                                },
                                "guide": {
                                "visible": false,
                                "line-style": "solid"
                                }
                            },
                            "plot": {
                                "aspect": "spline",
                                "tooltip": {
                                    "visible": true,
                                    "text": "Tiempo (h): %kt <br> Temperatura: %v" // use function to format y value
                                }
                            },
                            "series": [{
                                    "values": puntos,
                                    "line-color": "#3498DB",
                                    "line-width": 5,
                                    "marker": {
                                    "background-color": "#2E86C1",
                                    "size": 5,
                                    "border-color": "#2E86C1",
                                },
                            }]
                            };
                            zingchart.render({
                            id: 'verview-shart',
                            data: myConfig,
                            height: "100%",
                            width: "100%"
                            });
                        } else {
                            //console.log("No data available");
                        }
                }).catch((error) => {
                    console.error("Error getting data:", error);
                });
            }, 5000);
        }
        /*--------------  overview-chart start ------------*/
        if ($('#verview-shart-t').length) {
           
           // TODO: Add SDKs for Firebase products that you want to use
           // https://firebase.google.com/docs/web/setup#available-libraries
       
           // Your web app's Firebase configuration
           const firebaseConfig = {
            apiKey: "AIzaSyCymg0Ho3HMgHht2DYgRzZSekn2aZyMzco",
            authDomain: "tesis-esp.firebaseapp.com",
            databaseURL: "https://tesis-esp-default-rtdb.firebaseio.com",
            projectId: "tesis-esp",
            storageBucket: "tesis-esp.appspot.com",
            messagingSenderId: "998026311452",
            appId: "1:998026311452:web:4daa62dae5d8230700acd9"
           };
       
           // Initialize Firebase
           const app = initializeApp(firebaseConfig);
       
       
           //get ref to database services
           const db = getDatabase(app);
           var elementos = [];
           const messageRef = ref(db, 'sensores/DHT11');

           setInterval(() => {
               get(messageRef).then((snapshot) => {
                   if (snapshot.exists()) {
                       const children = snapshot.val();
                       const campoFecha = document.getElementById('start');
                       var valorFecha = campoFecha.value;
                       var fecha = new Date(valorFecha);
                       var dia = fecha.getDate() +1;
                       var mes = fecha.getMonth() + 1;
                       var year = fecha.getFullYear();
                       campoFecha.addEventListener('input', function() {
                           valorFecha = campoFecha.value;
                           fecha = new Date(valorFecha);
                           year = fecha.getFullYear();
                           dia = fecha.getDate() + 1;
                           mes = fecha.getMonth() + 1;
                           //console.log("D√≠a: ", dia);
                           //console.log("Mes: ", mes);
                           //console.log("A√±o: ", year);
                       });

                       //console.log("fecha", valorFecha); 
                       //console.log("children", children)
                       const lastChildText = JSON.stringify(children);
                       const obj = JSON.parse(lastChildText);
                       const temperaturaValues = [];
                       const tiempoValues = [];
                       for (const key in obj) {
                           if (obj.hasOwnProperty(key)) {
                               const temperatura = obj[key].temperatura;
                               temperaturaValues.push(temperatura);
                           }
                       }

                       for (const key in obj) {
                           if (obj.hasOwnProperty(key)) {
                               const tiempo = obj[key].tiempo;
                               tiempoValues.push(tiempo);
                           }
                       }

                       //console.log("tiempo", tiempoValues);
                       const valuest = Object.values(tiempoValues);
                       const posiciones = [];

                       for (var i = 0; i < valuest.length; i++) {
                           var hora = valuest[i].split(',');
                           var horanew = hora[0].replace(/^\(/, '');
                           var mesnew = hora[1].replace(/^\ /, '');
                           var dianew = hora[2].replace(/^\ /, '');
                           if(horanew == year.toString()){
                               if(mesnew == mes.toString()){
                                   if(dianew == dia.toString()){
                                       posiciones.push(i);
                                   }
                               }
                           }
                       }

                       //console.log("posiciones", posiciones);
                       const elementost = valuest.slice(-10);
                       //console.log("tiempo", elementost);
                       const values = Object.values(temperaturaValues);
                       const elementos = values.slice(-10);
                       //console.log("temperatura", elementos);
                       const listaDeEnteros = elementos.map(str => parseInt(str));
                       const listaHoras = [];
                       const listaMin = [];
                       for (var i = 0; i < valuest.length; i++) {
                           var hora = valuest[i].split(',');
                           listaHoras.push(hora[3]);
                           listaMin.push(hora[4]);
                       }
                       const listaHorasNew = listaHoras.map(str => parseInt(str));
                       const listaMinNew = listaMin.map(str => parseInt(str));
                       const puntos = [];
                       //console.log("Fechas:", listaHorasNew);
                       //console.log("Rangos:", temperaturaValues);
                       var ejeTemperatura = []; 
                       for (var i = 0; i < posiciones.length; i++) {
                           ejeTemperatura.push(parseInt(temperaturaValues[posiciones[i]]));
                           var minutosTotales = parseInt(listaHorasNew[posiciones[i]]) * 60 + parseInt(listaMinNew[posiciones[i]]);
                           var minimoMinutos = Math.floor(minutosTotales / 60) * 60; // Redondear hacia abajo a la hora m√°s cercana
                           var maximoMinutos = minimoMinutos + 60; // Sumar 60 minutos para obtener la siguiente hora

                           // Calcular el valor en la escala
                           var valorEnEscalaLarge = ((minutosTotales - minimoMinutos) / (maximoMinutos - minimoMinutos));
                           var valorEnEscala = Math.round(valorEnEscalaLarge * 100) / 100;
                           //console.log(parseInt(listaHorasNew[posiciones[i]]), "-", parseInt(listaMinNew[posiciones[i]]), "-", minutosTotales, "-", valorEnEscala+parseInt(listaHorasNew[posiciones[i]]));
                           const punto = [valorEnEscala+parseInt(listaHorasNew[posiciones[i]]), parseInt(temperaturaValues[posiciones[i]])]; // Crear el punto [x, y] a partir de los elementos correspondientes de las listas
                           //console.log("cada punto", punto);
                           puntos.push(punto); // Agregar el punto a la lista de puntos
                       }
                       //console.log("puntos", puntos); // Imprimir los puntos resultantes
                       var minimo = Math.min(...ejeTemperatura) - 1;
                       var maximo = Math.max(...ejeTemperatura) + 1;
                       //console.log("max", maximo);
                       //console.log("min", minimo);

                       function formatTime(value) {
                           var hours = Math.floor(value);
                           var minutes = Math.floor((value - hours) * 60);
                           //console.log("minutos", value, minutes);
                           return value*60;
                       }

                       var myConfig = {
                           "type": "line",
                           "scale-x": {
                               "values": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23],
                               "label": {
                               "font-size": 14,
                               "offset-x": 0
                               },
                               "item": {
                               "font-size": 10
                               },
                               "guide": {
                               "visible": false,
                               "line-style": "solid"
                               }
                           },
                           "scale-y": {
                               "min-value": minimo,
                               "max-value": maximo,
                               "label": {
                               "font-size": 14,
                               "offset-x": 0
                               },
                               "item": {
                               "font-size": 10
                               },
                               "guide": {
                               "visible": false,
                               "line-style": "solid"
                               }
                           },
                           "plot": {
                               "aspect": "spline",
                               "tooltip": {
                                   "visible": true,
                                   "text": "Tiempo (h): %kt <br> Temperatura: %v" // use function to format y value
                               }
                           },
                           "series": [{
                                   "values": puntos,
                                   "line-color": "#2ECC71",
                                   "line-width": 5,
                                   "marker": {
                                   "background-color": "#28B463",
                                   "size": 5,
                                   "border-color": "#28B463",
                               },
                           }]
                           };

                           zingchart.render({
                           id: 'verview-shart-t',
                           data: myConfig,
                           height: "100%",
                           width: "100%"
                           });
                       } else {
                           //console.log("No data available");
                       }
               }).catch((error) => {
                   console.error("Error getting data:", error);
               });
           }, 5000);
       }
    </script>
    <script>
        // Obtener la fecha actual
        const fechaActual = new Date();
        const diaActual = fechaActual.getDate();
        const fechaActualISO = fechaActual.toISOString().split('T')[0];
      
        // Establecer el valor m√°ximo y el valor actual del campo de entrada de fecha
        const campoFecha = document.getElementById('start');
        campoFecha.max = fechaActualISO;
        campoFecha.value = fechaActualISO;
      </script>
      <script>
        function toggleContent(selectedValue) {
            var contenidoHumedad = document.getElementById("verview-shart");
            var contenidoTemperatura = document.getElementById("verview-shart-t");
    
            if (selectedValue === "0") {
                contenidoHumedad.style.display = "none";
                contenidoTemperatura.style.display = "block";
            } else {
                contenidoHumedad.style.display = "block";
                contenidoTemperatura.style.display = "none";
            }
        }
    </script>
</body>
</html>